function renderCampaignTables(e){const t=document.getElementById("campaignsContainer"),n=groupDataByCampaignId(e);if(t.innerHTML="",0===Object.keys(n).length?showNoCampaignUI():Object.keys(n).forEach((e=>{const a=createTableForCampaign(e,n[e]);t.appendChild(a)})),Object.keys(n).length>0){const e=document.querySelector(".header-container"),t=document.createElement("button");t.id="createCampaignBtn",t.textContent="+ New Campaign",t.className="py-2 px-4 rounded-xl bg-transparent font-medium hover:bg-gray-700 text-gray-800 dark:text-gray-200 hover:text-white border dark:border-gray-200 border-gray-800 hover:border-transparent absolute right-4 rounded cursor-pointer ml-4",t.addEventListener("click",(()=>{generateTracking()})),e.appendChild(t)}}function showNoCampaignUI(){const e=document.getElementById("campaignsContainer"),t=document.createElement("p");t.textContent="No campaigns found. Create a new tracking code",t.className="text-center my-4 pt-[25dvh]";const n=document.createElement("button");n.textContent="Create New Tracking Code",n.className="block mx-auto my-6 py-2 px-4 bg-gray-800 text-white rounded hover:bg-gray-700 cursor-pointer",n.addEventListener("click",(()=>{generateTracking()})),e.appendChild(t),t.appendChild(n)}function createTableForCampaign(e,t){const n=document.createElement("div");n.className="bg-white dark:bg-gray-900 shadow overflow-hidden sm:rounded-lg my-8 pt-2",n.id=e;const a=document.createElement("div");a.className="px-4 py-4 sm:px-6 relative",a.innerHTML=`<h3 class="text-2xl leading-6 font-medium text-gray-900 dark:text-white capitalize">ðŸŽ¯ <a class="hover:underline" href="/campaigns/${e}">${e.replaceAll("-"," ").replaceAll("_"," ")}</a></h3>`;const o=document.createElement("button");o.className="view-details-btn bg-gray-800 hover:bg-gray-700 absolute top-4 right-14 cursor-pointer",o.textContent="View Details",o.addEventListener("click",(function(){location.replace("/campaigns/"+e)})),a.appendChild(o);const l=document.createElement("i");l.className="fas fa-ellipsis-v absolute top-6 right-6 cursor-pointer",l.addEventListener("click",(function(t){t.stopPropagation(),showDropdownMenu(this,e)})),a.appendChild(l),n.appendChild(a);const d=t.length,r=new Set(t.map((e=>e.geo.ip))).size,i=new Set(t.map((e=>e.referrer))).size,c=new Set(t.map((e=>e.path))).size,s=new Set(t.map((e=>e.geo.country))).size,p=new Set(t.map((e=>e.geo.timezone))).size,m=document.createElement("div");m.className="flex justify-around m-2 mt-3";[{value:d,label:"Views"},{value:r,label:"IPs"},{value:i,label:"Referrers"},{value:c,label:"Events"},{value:s,label:"Countries"},{value:p,label:"Time Zones"}].forEach((e=>{const t=document.createElement("div");t.className="inline-flex flex-col items-center justify-center w-1/6 p-4",t.innerHTML=`<span class="text-xl xl:text-3xl font-bold">${e.value}</span><label class="text-sm xl:text-lg font-medium">${e.label}</label>`,m.appendChild(t)})),n.appendChild(m);const u=document.createElement("div");u.className="",u.innerHTML='<h4 class="mt-6 font-semibold mb-4 ml-4">5 Most Recent Events <em class="text-xs font-light text-light">(Not Realtime)</em></h4>',n.appendChild(u);const g=document.createElement("div");g.className="overflow-x-auto";const h=document.createElement("table");h.className="min-w-full divide-y divide-gray-200 dark:divide-gray-600";const y=document.createElement("tr");y.className="bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 uppercase text-sm leading-normal",["Event","referrer","IP","Browser","Device","OS","Country","Region","City","Timezone","Language","Timestamp"].forEach((e=>{const t=document.createElement("th");t.className="py-3 px-6 text-left whitespace-nowrap",t.textContent=e,y.appendChild(t)})),h.appendChild(y);return t.sort(((e,t)=>new Date(t.decay)-new Date(e.decay))).slice(0,5).forEach(((e,t)=>{const n=document.createElement("tr");n.className=t%2==0?"bg-white dark:bg-gray-700":"bg-gray-100 dark:bg-gray-500",n.innerHTML=`\n            <td class="px-4 py-2 whitespace-nowrap">${eventFromPath(e.path)||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${e.referrer||"direct"}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${e.geo?.ip.replace("::ffff:","").replace("::1","localhost")||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${getBrowserIcon(e.useragent?.browser)} ${e.useragent?.browser||""} ${e.useragent?.version||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${getDeviceIcon(e.useragent?.device)} ${e.useragent?.device||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${getOSIcon(e.useragent?.os)} ${e.useragent?.os||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${getCountryFlagIcon(e.geo.country)} ${e.geo.country||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${e.geo.region||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${e.geo.city||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${e.geo.timezone||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${e.language.join(", ")||""}</td>\n            <td class="px-4 py-2 whitespace-nowrap">${new Date(e.decay).toLocaleString()||""}</td>\n        `,h.appendChild(n)})),g.appendChild(h),n.appendChild(g),n}function formatParams(e){return"string"==typeof e?Object.entries(JSON.parse(e)).map((([e,t])=>`${e}: ${t}`)).join(", "):e?Object.entries(e).map((([e,t])=>`${e}: ${t}`)).join(", "):""}function showDropdownMenu(e,t){closeAllDropdowns();const n=document.createElement("div");n.className="dropdown-menu",n.innerHTML=`\n        <ul>\n            <li class="dropdown-item" onclick="generateTracking('${t}')">Generate Tracking Image</li>\n            <li class="dropdown-item" onclick="deleteCampaign('${t}')">Delete Campaign & Data</li>\n        </ul>\n    `,n.style.position="absolute",n.style.top=`${e.offsetTop+e.offsetHeight}px`,n.style.right="10px";e.parentElement.appendChild(n),document.addEventListener("click",closeAllDropdowns)}function closeAllDropdowns(){document.querySelectorAll(".dropdown-menu").forEach((e=>{e.remove()}))}function deleteCampaign(e){confirm("Are you sure? This will delete all existing tracking data for this campaign and cannot be undone.")&&fetch(`track/api/campaign/${e}`,{method:"DELETE"}).then((e=>e.json())).then((t=>{const n=document.getElementById(e);n&&(n.remove(),location.reload())})).catch((e=>{}))}function generateTracking(e=""){const t=document.createElement("div");t.className="tracking-modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full";let n=`\n        <div class="modal-content bg-white p-6 mx-auto rounded-lg shadow-lg relative min-w-max top-20">\n            <h2 class="text-xl font-semibold mb-4">Generate Tracking URL and Embed Code</h2>\n            \n            \x3c!-- Campaign ID input --\x3e\n            <div class="mb-4">\n                <label for="campaignIdInput" class="block text-gray-700 text-sm font-bold mb-2">Campaign ID:</label>\n                <input type="text" id="campaignIdInput" name="campaignIdInput" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" value="${e.replace(/\s+/g,"-")}" placeholder="Enter campaign ID"/>\n            </div>\n\n            \x3c!-- Tracking Method --\x3e\n            <div class="mb-4">\n                <label for="trackingMethod" class="block text-gray-700 text-sm font-bold mb-2">Tracking Method:</label>\n                <select id="trackingMethod" name="trackingMethod" class="bg-white border border-gray-300 text-gray-700 rounded leading-tight outline-none focus:outline-none focus:bg-white focus:border-blue-500 appearance-none">\n                    <option value="image">Image Embed</option>\n                    <option value="link">Link</option>\n                    <option value="form">Form Submission</option>\n                </select>\n            </div>\n\n            \x3c!-- Event Type --\x3e\n            <div class="mb-4" id="eventTypeContainer"></div>\n\n            \x3c!-- Additional Options --\x3e\n            <div class="mb-4" id="additionalOptions"></div>\n\n            \x3c!-- Generated Code --\x3e\n            <div class="mt-4">\n                <p class="text-sm font-bold mb-2">Generated Code:</p>\n                <pre id="generatedCode" class="text-sm bg-gray-100 rounded p-2"></pre>\n            </div>\n\n            <button onclick="closeModal()" class="absolute top-2 right-2 bg-gray-800 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Close</button>\n        </div>\n    `;t.innerHTML=n,document.body.appendChild(t);const a=document.getElementById("campaignIdInput");a.addEventListener("input",(()=>{a.value=a.value.replace(/\s+/g,"-"),updateTrackingInfo()}));document.getElementById("trackingMethod").addEventListener("change",(()=>{updateEventTypeOptions(),updateTrackingInfo()})),updateEventTypeOptions(),updateTrackingInfo()}function updateEventTypeOptions(){const e=document.getElementById("trackingMethod").value;let t="";t="form"===e?'\n            <label for="formAction" class="block text-gray-700 text-sm font-bold mb-2">Form Action:</label>\n            <select id="formAction" name="formAction" class="bg-white border border-gray-300 text-gray-700 rounded leading-tight outline-none focus:outline-none focus:bg-white focus:border-blue-500 appearance-none">\n                <option value="redirect">Redirect</option>\n                <option value="download">File Download</option>\n            </select>\n        ':"link"===e?'<input type="hidden" id="eventType" value="click" />':'\n            <label for="eventType" class="block text-gray-700 text-sm font-bold mb-2">Event Type:</label>\n            <select id="eventType" name="eventType" class="bg-white border border-gray-300 text-gray-700 rounded leading-tight outline-none focus:outline-none focus:bg-white focus:border-blue-500 appearance-none">\n                <option value="pageview">PageView</option>\n                <option value="email-open">Email-Open</option>\n                <option value="other">Other</option>\n            </select>\n            <input type="text" id="customEventType" name="customEventType" class="hidden mt-3 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter custom event type"/>\n        ',document.getElementById("eventTypeContainer").innerHTML=t;const n=document.getElementById("eventType"),a=document.getElementById("formAction");n&&n.addEventListener("change",(()=>{updateAdditionalOptions(),updateTrackingInfo()})),a&&a.addEventListener("change",updateAdditionalOptions),updateAdditionalOptions()}function updateAdditionalOptions(){const e=document.getElementById("trackingMethod").value,t=document.getElementById("formAction")?document.getElementById("formAction").value:"",n=document.getElementById("additionalOptions");let a="";if("link"===e){a='\n            <label for="redirectUrl" class="block text-gray-700 text-sm font-bold mb-2">Redirect URL:</label>\n            <input type="text" id="redirectUrl" name="redirectUrl" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter redirect URL (ex. https://google.com)"/>\n        ',n.innerHTML=a;document.getElementById("redirectUrl").addEventListener("input",updateTrackingInfo)}else if("form"===e){"redirect"===t?a='\n                <label for="redirectUrl" class="block text-gray-700 text-sm font-bold mb-2">Redirect URL:</label>\n                <input type="text" id="redirectUrl" name="redirectUrl" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter redirect URL (ex. https://google.com)"/>\n            ':"download"===t&&(a='\n                <label for="fileDownloadPath" class="block text-gray-700 text-sm font-bold mb-2">File Download Path:</label>\n                <input type="text" id="fileDownloadPath" name="fileDownloadPath" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter file download path (ex. /downloads/myfile.pdf)"/>\n            '),n.innerHTML=a;const e=document.getElementById("redirectUrl"),o=document.getElementById("fileDownloadPath");e&&e.addEventListener("input",updateTrackingInfo),o&&o.addEventListener("input",updateTrackingInfo)}else n.innerHTML=""}function updateTrackingInfo(){const e=window.location.protocol+"//"+window.location.host,t=document.getElementById("campaignIdInput").value,n=document.getElementById("trackingMethod").value,a=document.getElementById("eventType")?document.getElementById("eventType").value:"",o=document.getElementById("customEventType")?document.getElementById("customEventType").value:"",l=document.getElementById("redirectUrl")?document.getElementById("redirectUrl").value:"",d=document.getElementById("fileDownloadPath")?document.getElementById("fileDownloadPath").value:"";let r="other"===a&&o?o:a,i=`${e}/track/${r}.gif?campaignID=${t}`,c=`${e}/track/${r}?campaignID=${t}&redirectURL=${encodeURIComponent(l)}`,s="";"image"===n?s=`<img src="${i}" alt="NanoTrack" />`:"link"===n?s=`<a href="${c}">Click here</a>`:"form"===n&&(s=`<form action="${e}/track" method="post">\n            <input type="hidden" name="campaignID" value="${t}">\n            <input type="hidden" name="eventPath" value="${r}">`,"redirect"===document.getElementById("formAction").value?s+=`<input type="hidden" name="redirectUrl" value="${l}">`:"download"===document.getElementById("formAction").value&&(s+=`<input type="hidden" name="fileDownloadPath" value="${d}">`),s+='\n            \x3c!-- Add other form fields here --\x3e\n            <button type="submit">Submit</button>\n        </form>'),document.getElementById("generatedCode").innerHTML=escapeHtml(s)}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function closeModal(){const e=document.querySelector(".tracking-modal");e&&e.remove()}document.addEventListener("DOMContentLoaded",(function(){fetchData().then((()=>{renderCampaignTables(trackingData)})).catch((e=>{}))}));